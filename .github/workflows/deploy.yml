name: Deploy Next.js SSG to Hostinger

on:
  push:
    branches:
      - main  # Revisa si tu rama se llama 'main' o 'master'

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. Bajar el cÃ³digo
      - name: ğŸšš Checkout
        uses: actions/checkout@v4

      # 2. Instalar Node.js (Next.js suele pedir versiones recientes)
      - name: ğŸŸ¢ Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm' # Esto hace que las siguientes veces sea mÃ¡s rÃ¡pido

      # Cache de build y dependencias para acelerar rebuilds de Next.js
      - name: âš¡ Cache node_modules and Next build cache
        uses: actions/cache@v4
        with:
          path: |
            node_modules
            .next/cache
          key: ${{ runner.os }}-next-cache-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-next-cache-

      # 3. Instalar dependencias
      - name: ğŸ“¦ Install Dependencies
        run: npm ci 
        # 'npm ci' es mÃ¡s seguro y rÃ¡pido que 'npm install' para entornos automÃ¡ticos

      # 4. Construir el proyecto (Genera la carpeta 'out')
      - name: ğŸ—ï¸ Build
        run: npm run build

      # 5. Subir a Hostinger via FTP
      - name: ğŸš€ Deploy via FTP
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./out/        # Next.js genera los estÃ¡ticos aquÃ­ (ajusta si tu salida es diferente)
          # IMPORTANT: no uses './public_html/' â€” usa el nombre relativo al FTP root
          # Usar './public_html/' puede crear una carpeta `public_html` dentro de `public_html`.
          server-dir: ./ # La raÃ­z de tu web en Hostinger (relativo al FTP home)
          dangerous-clean-slate: true # BORRA lo que no estÃ© en 'out'. Â¡Cuidado si tienes otros archivos en el hosting!
          protocol: ftps            # Hostinger requiere FTPS explÃ­cito
          port: 21                  # Aseguramos el puerto
          security: loose              # Permite conexiones menos estrictas
          timeout: 60000